# 일지
## 250304 
### 차용증 NFT 서비스 기능 명세

#### 차용증 NFT 생성
- 채무자가 차용증 계약 조건 입력 (원금, 이자율, 상환 기간, 이자 계산 방식)
- 채무자 서명 후 계약 전송
- 채권자 서명 후 계약 확정 (채권자의 캐시가 원금 이상일 경우 가능)
- 채권자의 캐시를 채무자에게 지급
- 차용증 NFT 발행 (채권자에게 지급)
- 원금 트랜잭션 즉시 생성 및 기록


#### 이자 발생 및 계산 단계
- 계약에 지정된 날짜(월별/분기별/연간)마다 이자 자동 계산
- 남은 원금 기준으로 이자 계산
- 이자 발생 트랜잭션 자동 생성
- 채무자에게 이자 발생 알림

#### 상환 단계
- 채무자가 서비스에서 상환 요청 (원금 또는 이자)
- 가상계좌 또는 지정된 결제 수단으로 입금
- 시스템에서 입금 확인
- 상환 내역 블록체인에 기록
- 차용증 NFT 메타데이터 업데이트
- 남은 원금 업데이트

#### 완전 상환 단계
- 모든 원금과 이자 상환 완료 시
- NFT 소각

<hr>

## 250305
### 프로젝트에 사용할 블록체인 기술 공부 및 정리리

#### 스마트 계약 배포
- 차용증 관리를 위한 스마트 계약 배포
- 관리자 계정 설정 (상환 기록 업데이트 권한 보유)

#### NFT Minting(발생/생성) 및 원금 트랜잭션 생성
- 계약 확정 시 NFT 발행
- 계약 세부 정보를 메타데이터로 포함
- 초기 원금 트랜잭션 즉시 생성
- 트랜잭션 발생: `mintLoanNFT(채권자주소, 원금, 이자율, 기간, 메타데이터)`

#### 이자 계산 및 트랜잭션 생성
- 이자 계산 주기에 따라 자동 이자 계산 (시스템 트리거)
- 현재 남은 원금 계산: 초기 원금 트랜잭션과 모든 상환 트랜잭션을 조회하여 현재 남은 원금 계산
- 이자 금액 계산: 계산된 남은 원금 × 이자율 기준으로 이자 금액 결정
- 이자 발생 트랜잭션 자동 생성: `generateInterest(NFT_ID, 이자금액, 계산일자)`
- 이자 발생 이벤트 기록: `InterestAccrualEvent(NFT_ID, 이자금액, 계산일자, 남은원금)`
    - 이벤트는 트랜잭션 생성 시 자동으로 작성됨

트랜잭션과 이벤트 차이
- 트랜잭션 (무엇인가를 변경하는 행위)
    - 블록체인의 상태를 변경하는 작업 (예: 원금 상환, 이자 기록)
    - 블록체인에 영구적으로 기록
- 이벤트 (그 행위가 발생했음을 알리는 신호)
    - 트랜잭션 실행 중에 발생하는 로그 기록
    - `emit` 키워드를 사용해 명시적으로 발행
    - 트랜잭션의 일부로 생성
    - 블록체인 상태를 변경 X
    - 트랜잭션에 포함되지 않은 추가 정보를 기록
    - 외부 시스템이 블록체인 활동을 모니터링하기 쉽게 함
- 둘의 관계
    - 트랜잭션이 실행되는 동안 스마트 계약 코드에서 이벤트를 발행
    - 트랜잭션이 성공적으로 처리되면 발행된 이벤트가 블록체인에 로그로 기록
    - 이벤트 없이 트랜잭션은 가능하지만, 트랜잭션 없이 이벤트는 발생할 수 없음

#### 상환
- 입금 확인 후 관리자 계정에서 트랜잭션 발행
- 원금 상환: `repayPrincipal(NFT_ID, 금액)` 트랜잭션 호출
- 이자 상환: `repayInterest(NFT_ID, 금액)` 트랜잭션 호출
- 각 상환마다 별도 트랜잭션 생성
- 트랜잭션 내에서 이벤트 발행: `emit RepaymentEvent(NFT_ID, 금액, 타입, 일시)`

#### 완전 상환 처리
- 완전 상환 확인 시 트랜잭션 발행: `completeLoan(NFT_ID)`
- 해당 NFT 소각
